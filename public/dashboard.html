<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GymTracker - Dashboard</title>
    <link rel="stylesheet" href="/css/styles.css" />
  </head>
  <body class="bg-gray-100">
    <main class="max-w-5xl mx-auto px-4 py-8 space-y-6">
      <div class="bg-white rounded-lg shadow p-6">
        <h1 class="text-2xl font-bold mb-2">
          Welcome back, <span id="userName"></span>!
        </h1>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-1 gap-4">
        <div class="bg-white rounded-lg shadow p-4">
          <h3 class="text-gray-500 text-sm">Total Workouts</h3>
          <p class="text-2xl font-bold" id="totalWorkouts">0</p>
        </div>
      </div>

      <div class="grid grid-cols-1 gap-6">
        <div class="bg-white rounded-lg shadow p-6">
          <div class="flex items-center justify-between mb-3">
            <h2 class="text-xl font-semibold">Recent Workouts</h2>
          </div>
          <div id="recentWorkouts" class="space-y-2">
            <p class="text-gray-500">No workouts yet.</p>
          </div>
        </div>
      </div>
    </main>

    <script src="/js/session.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        if (!Session.requireLogin()) return;
        renderNavbar();
        loadDashboard();
      });

      async function loadDashboard() {
        const user = Session.getCurrentUser();

        document.getElementById("userName").textContent = user.name;

        try {
          const res = await fetch(`/api/workouts/${user._id}`);
          if (!res.ok) throw new Error("Failed to load workouts");
          const workouts = await res.json();
          updateWorkoutStats(workouts);
          displayRecentWorkouts(workouts.slice(0, 5));
        } catch (error) {
          console.error("Error loading workouts:", error);
        }
      }

      function updateWorkoutStats(workouts) {
        document.getElementById("totalWorkouts").textContent = workouts.length;
      }

      function displayRecentWorkouts(workouts) {
        const container = document.getElementById("recentWorkouts");
        if (!workouts.length) return;

        container.innerHTML = workouts
          .map(
            (workout) => `
                <div class="border-l-4 border-blue-500 pl-4 py-2">
                    <div class="flex justify-between">
                        <div>
                            <p class="font-semibold">${new Date(
                              workout.date
                            ).toLocaleDateString()}</p>
                            <p class="text-sm text-gray-600">${
                              (workout.exercises || []).length
                            } exercises</p>
                        </div>
                        <button onclick="viewWorkout('${
                          workout._id
                        }')" class="text-blue-500 hover:underline">
                            Open
                        </button>
                    </div>
                </div>
            `
          )
          .join("");
      }

      function viewWorkout(id) {
        window.location.href = `/workout.html?id=${id}`;
      }
    </script>
  </body>
</html>
