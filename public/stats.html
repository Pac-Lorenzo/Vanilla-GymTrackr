<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stats</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
  <main class="max-w-4xl mx-auto px-4 py-8 space-y-4">
    <div class="flex items-center justify-between">
      <h1 class="text-2xl font-bold">Personal Records</h1>
      <button id="refreshBtn" class="text-blue-500 hover:underline text-sm">Refresh</button>
    </div>
    <section class="bg-white rounded shadow p-4">
      <div id="prList" class="space-y-2 text-sm text-gray-800">Loading...</div>
    </section>
  </main>

  <script src="/js/session.js"></script>
  <script src="/js/api.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      if (!Session.requireLogin()) return;
      renderNavbar();
      loadPrs();
    });

    document.getElementById('refreshBtn').addEventListener('click', loadPrs);

    async function loadPrs() {
      const user = Session.getCurrentUser();
      try {
        const prs = await API.prs.listForUser(user._id);
        renderPrList(prs || []);
      } catch (err) {
        document.getElementById('prList').textContent = 'Could not load stats.';
      }
    }

    function renderPrList(list) {
      const container = document.getElementById('prList');
      if (!list.length) {
        container.textContent = 'No PRs yet. Log a workout to start tracking.';
        return;
      }
      container.innerHTML = list.map(pr => `
        <div class="border rounded px-3 py-2 flex justify-between">
          <span>${pr.exercise_id}</span>
          <span class="font-semibold">${pr.best_weight || 0} lbs</span>
        </div>
      `).join('');
    }
  </script>
</body>
</html>
